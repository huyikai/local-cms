#!/usr/bin/env node

import{execSync as e,exec as o}from"child_process";import{Command as t}from"commander";import n from"chalk";import r from"fs-extra";import i from"inquirer";import a from"ora";import s from"path";import c from"figlet";import{fileURLToPath as m}from"url";const l=process.cwd(),p=a(),d=e=>n.blue.bold(e);var u=async o=>{const{name:t,author:n,version:a,newDir:c}=o,m=s.join(l,c?t:""),u=async()=>{p.start("Installing..."),(async()=>{e("npm init -y"),e("npm install @huyikai/vitepress-helper@latest",{stdio:"inherit"});const o=s.join(l,"node_modules/@huyikai/vitepress-helper/template"),i=s.join(l,"");r.copySync(o,i),(()=>{const e=s.join(l,"package.json");let o=JSON.parse(r.readFileSync(e).toString());o.name=t,o.author=n,o.version=a,o.scripts.cms="node node_modules/@huyikai/local-cms/cms.js docs",o.devDependencies["@huyikai/vitepress-helper"]="latest",o.devDependencies["@huyikai/local-cms"]="latest",r.writeFileSync(e,JSON.stringify(o,null,2))})(),e("npm i",{stdio:"inherit"}),p.succeed("Install Complete!!!"),console.log(`\r\nNow you can:\r\nrun ${d("npm run dev")} to preview`),console.log(`\r\nrun ${d("npm run cms")} to manage content`)})()};c&&r.existsSync(m)?i.prompt([{name:"action",type:"list",message:"Target directory already exists Pick an action:",choices:[{name:"Overwrite",value:"overwrite"},{name:"Cancel",value:!1}]}]).then((e=>{"overwrite"===e.action&&(r.removeSync(m),u())})):u()};const y=a(),h=new t;h.name("local-cms").description("A Management System for Managing Local markdown Files\r\n一个管理本地 markdown 文件的管理系统");const g=process.cwd(),v=e=>n.blue.bold(e),f=s.dirname(m(import.meta.url)),w=s.join(f,"./../../package.json"),S=JSON.parse(r.readFileSync(w,"utf8"));h.version(S.version,"-v,-V, --version","Output current version information");const k=[{type:"list",name:"action",message:"Please select the action you want to perform:(请选择您要执行的操作：)",choices:[{name:"1.Add 'Local-CMS' to the current directory to manage the content.(在当前目录添加 'Local-CMS' 来管理内容)",value:"next"},{name:"2.Create a CMS project based on 'VitePress Custom' management.(新建一个基于 'VitePress' 管理的 CMS 的项目)",value:"new"}]}];h.command("init").description("Guide to complete the initialization operation").summary("initialization").action((async()=>{let t=await i.prompt(k);if("next"===t.action){let t=await i.prompt([{name:"directory",message:"Set up a directory to store content.\r\n设置一个用来存放内容的目录",type:"input",default:"docs"}]);if(!r.existsSync("./package.json"))try{e("npm init -y")}catch(e){return void console.error(`exec error: ${e}`)}await(async e=>{const t=s.join(g,"./package.json"),n=JSON.parse(r.readFileSync(t).toString()),a=()=>{const o=`node node_modules/@huyikai/local-cms/cms.js ${e.directory}`;n.scripts.cms=o,r.writeFileSync(t,JSON.stringify(n,null,2))};n.scripts.cms?(await i.prompt({type:"confirm",name:"overwrite",message:"The cms command already exists in the script of the packages.json file, do you want to overwrite it? \r\npackages.json 文件的 scripts 中已存在 cms 命令，是否覆盖？\r\n"})).overwrite&&a():a();y.start("Installing..."),o("npm i @huyikai/local-cms -D",(async o=>{if(o)return void console.error(`exec error: ${o}`);r.existsSync(e.directory)||r.mkdirSync(e.directory),y.succeed("install Complete!!!");const t=v("npm run cms");console.log(`\r\nNow you can execute ${t} to run cms management content.\r\n现在你可以执行 ${t} 来运行 cms 来管理内容了。\r\n`)}))})({directory:t.directory})}else if("new"===t.action){const e=[{name:"name",message:"Project Name",type:"input",default:"my-docs"},{name:"author",description:"Input Author Name",message:"Author",default:"huyikai"},{name:"version",description:"Version",message:"Version",default:"1.0.0"},{name:"newDir",message:"Create A New Directory?",type:"list",choices:[{name:"yes",value:!0},{name:"no",value:!1}]}];let o=await i.prompt(e);u(o)}})),h.usage("<command> [option]"),h.on("--help",(()=>{console.log(`\r\nRun ${v("cms <command> --help")} for detailed usage of given command`),console.log(`\r\nGitHub: ${v("https://github.com/huyikai/local-cms")}`),console.log(`\r\nHomePage: ${v("https://huyikai.github.io/local-cms")}`),console.log("\r\n"+n.hex("#41B883").bgHex("#35495E").bold(c.textSync("Local CMS",{font:"Standard",horizontalLayout:"default",verticalLayout:"default",width:90,whitespaceBreak:!1})))})),h.parse(process.argv);
//# sourceMappingURL=cli.js.map
